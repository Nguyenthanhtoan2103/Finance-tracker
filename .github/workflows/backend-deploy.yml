# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

# This workflow integrates njsscan with GitHub's Code Scanning feature
# nodejsscan is a static security code scanner that finds insecure code patterns in your Node.js applications

name: NodeChef Deploy

on:
  push:
    branches:
      - main 

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '20'

    - name: Install dependencies
      run: npm install
      
    - name: Deploy to NodeChef
      env:
        DEPLOY_USER: ${{ secrets.NODECHEF_USER }}
        DEPLOY_PASSWORD: ${{ secrets.NODECHEF_PASSWORD }}
        APP_NAME: ${{ secrets.NODECHEF_APP }}
        APP_SERVER: ${{ secrets.NODECHEF_HOST }}
      run: |
        curl -u $DEPLOY_USER:$DEPLOY_PASSWORD \
        -X POST https://$APP_SERVER/api/deploy/$APP_NAME
